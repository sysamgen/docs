System overview
==================

Samgen system enables processing genetic sequences through customizable bioinformatics pipelines aiming to identify clinically significant variants at DNA and RNA level.
Output files are stored on the filesystem and relevant variants are additionally exported to relational database.

Main componenets are:

Workflow manager
------------------

A workflow manager enables the definition, launch and supervision of data processing pipelines. Samgen utilizes `Apache Airflow <https://airflow.apache.org/>`_ as workflow manager with `CWL-Airflow <https://github.com/Barski-lab/cwl-airflow>`_ extension. 
Pipelines are defined and can be further customized using Python language and `CWL <https://www.commonwl.org/v1.0/>`_ language.
Most bioinformatics pipelines are based on open-source examples from publica repositories eg. `MGI's workflows <https://github.com/genome/analysis-workflows>`_ or `Kids Firs workflows <https://github.com/kids-first>`_.
The pipelines were patched, updated and optimized for samgen's use cases.

Custom steps (e.g setupping configuration or variants ETL process) were developed in Python.

`Current Airflow instance <http://samgen-airflow.czd.pl>`_

Core technologies: Apache Airflow, CWL, CWL-Airflow.

Variants DB
-------------

Relational database stores relevant data from completed bioinformatics pipelines for quick access and further analysis. 
The data model includes storing annotated variants, genotypes, sample and patients information as wel as version metadata. 
Migration process which is performed when data model is changed (e.g. additional columns are added, or new version of annotation sources are available) keeps previous version of variant annotations and creates new variants table. 

Data are accessed through standard JDBC protocol.

Core technologies: PostgreSQL

.. image:: img/er.png

.. image:: img/relational.png


Analytical Platform
--------------------

An analytical platform enabling advanced programming analyzes on clinically relevant data. The platform is built upon `Jupyter <https://jupyter.org/>`_ platform. 
Several per-sample and multi-sample notebooks templates for germline, somatic and rna analysis are available under notebooks repository. Per-sample notebooks are automatically generated after pipeline run finishes.

`Current Jupyter instance <http://samgen-jupyter.czd.pl/>`_

Core technologies: Jupyter Notebooks, Python


Monitoring Platform
--------------------

The monitoring dashboard uses `Grafana <https://grafana.com/>`_ stack and visualizes CPU Load, RAM and SWAP used, network traffic, disk space used and other metrics.

`Current Jupyter instance <http://samgen-monitoring.czd.pl/>`_ 

Core technologies: Grafana, Prometheus
